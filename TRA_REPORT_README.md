# TraReport - è¶…åˆ†è¾¨ç‡æ¨¡å‹è¯„ä¼°å·¥å…·

TraReportæ˜¯ä¸€ä¸ªç”¨äºè¯„ä¼°è¶…åˆ†è¾¨ç‡æ¨¡å‹æ€§èƒ½çš„å·¥å…·ç±»ï¼Œå®ƒå¯ä»¥åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œå¯¹éªŒè¯é›†ä¸­çš„å›¾ç‰‡è¿›è¡Œè¶…åˆ†è¾¨ç‡å¤„ç†ï¼Œç„¶åä¸çœŸå®é«˜åˆ†è¾¨ç‡å›¾ç‰‡è®¡ç®—PSNRæŒ‡æ ‡ï¼Œå¹¶è¾“å‡ºJSONæ ¼å¼çš„è¯„ä¼°ç»“æœã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”§ **æ¨¡å‹åŠ è½½**: æ”¯æŒä»é…ç½®æ–‡ä»¶å’Œæ£€æŸ¥ç‚¹åŠ è½½StableSRæ¨¡å‹
- ğŸ–¼ï¸ **å›¾ç‰‡å¤„ç†**: è‡ªåŠ¨å¤„ç†valç›®å½•ä¸­çš„æ‰€æœ‰å›¾ç‰‡è¿›è¡Œè¶…åˆ†è¾¨ç‡
- ğŸ“Š **PSNRè®¡ç®—**: ä¸gtç›®å½•ä¸­å¯¹åº”æ–‡ä»¶åçš„å›¾ç‰‡è®¡ç®—PSNRæŒ‡æ ‡
- ğŸ“„ **JSONè¾“å‡º**: ç”Ÿæˆè¯¦ç»†çš„JSONæ ¼å¼è¯„ä¼°æŠ¥å‘Š
- âš™ï¸ **çµæ´»é…ç½®**: æ”¯æŒå¤šç§å‚æ•°é…ç½®ï¼ˆDDPMæ­¥æ•°ã€æ”¾å¤§å€æ•°ã€é¢œè‰²ä¿®å¤ç­‰ï¼‰

## å®‰è£…ä¾èµ–

ç¡®ä¿å·²å®‰è£…ä»¥ä¸‹ä¾èµ–ï¼š

```bash
pip install torch torchvision
pip install omegaconf
pip install pytorch-lightning
pip install basicsr
pip install pillow
pip install tqdm
pip install opencv-python
```

## ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨

```python
from tra_report import TraReport

# åˆ›å»ºTraReportå®ä¾‹
tra_report = TraReport(
    gt_dir="/path/to/gt/images",      # çœŸå®é«˜åˆ†è¾¨ç‡å›¾ç‰‡ç›®å½•
    val_dir="/path/to/val/images",    # å¾…å¤„ç†çš„ä½åˆ†è¾¨ç‡å›¾ç‰‡ç›®å½•
    model_path="/path/to/model.ckpt", # æ¨¡å‹æƒé‡æ–‡ä»¶è·¯å¾„
    config_path="./configs/stableSRNew/v2-finetune_text_T_512_edge.yaml"  # é…ç½®æ–‡ä»¶è·¯å¾„
)

# è¿è¡Œè¯„ä¼°
results = tra_report.run_evaluation(output_path="evaluation_results.json")
```

### 2. å‘½ä»¤è¡Œä½¿ç”¨

```bash
python run_tra_report.py \
    --gt_dir /path/to/gt/images \
    --val_dir /path/to/val/images \
    --model_path /path/to/model.ckpt \
    --output results.json
```

### 3. é«˜çº§å‚æ•°é…ç½®

```python
tra_report = TraReport(
    gt_dir="/data/DIV2K_valid_HR",
    val_dir="/data/DIV2K_valid_LR", 
    model_path="./weights/stablesr_000117.ckpt",
    config_path="./configs/stableSRNew/v2-finetune_text_T_512_edge.yaml",
    ddpm_steps=200,           # DDPMé‡‡æ ·æ­¥æ•°
    upscale=4.0,              # è¶…åˆ†è¾¨ç‡å€æ•°
    colorfix_type="adain",    # é¢œè‰²ä¿®å¤ç±»å‹: adain/wavelet/none
    seed=42,                  # éšæœºç§å­
    device="cuda"             # è®¡ç®—è®¾å¤‡
)
```

## å‚æ•°è¯´æ˜

### å¿…éœ€å‚æ•°
- `gt_dir`: çœŸå®é«˜åˆ†è¾¨ç‡å›¾ç‰‡ç›®å½•è·¯å¾„
- `val_dir`: å¾…å¤„ç†çš„ä½åˆ†è¾¨ç‡å›¾ç‰‡ç›®å½•è·¯å¾„  
- `model_path`: æ¨¡å‹æƒé‡æ–‡ä»¶è·¯å¾„

### å¯é€‰å‚æ•°
- `config_path`: æ¨¡å‹é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ä½¿ç”¨edgeé…ç½®ï¼‰
- `ddpm_steps`: DDPMé‡‡æ ·æ­¥æ•°ï¼ˆé»˜è®¤ï¼š200ï¼‰
- `upscale`: è¶…åˆ†è¾¨ç‡å€æ•°ï¼ˆé»˜è®¤ï¼š4.0ï¼‰
- `colorfix_type`: é¢œè‰²ä¿®å¤ç±»å‹ï¼Œå¯é€‰å€¼ï¼š`adain`ã€`wavelet`ã€`none`ï¼ˆé»˜è®¤ï¼šadainï¼‰
- `seed`: éšæœºç§å­ï¼ˆé»˜è®¤ï¼š42ï¼‰
- `device`: è®¡ç®—è®¾å¤‡ï¼ˆé»˜è®¤ï¼šcudaï¼‰

## è¾“å‡ºæ ¼å¼

è¯„ä¼°ç»“æœä»¥JSONæ ¼å¼è¾“å‡ºï¼ŒåŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š

```json
{
  "model_path": "/path/to/model.ckpt",
  "config_path": "./configs/stableSRNew/v2-finetune_text_T_512_edge.yaml",
  "gt_dir": "/path/to/gt/images",
  "val_dir": "/path/to/val/images",
  "total_files": 100,
  "parameters": {
    "ddpm_steps": 200,
    "upscale": 4.0,
    "colorfix_type": "adain",
    "seed": 42
  },
  "results": [
    {
      "val_file": "/path/to/val/images/001.png",
      "gt_file": "/path/to/gt/images/001.png", 
      "psnr": 28.4567,
      "sr_shape": [1024, 1024, 3],
      "gt_shape": [1024, 1024, 3]
    }
  ],
  "summary": {
    "average_psnr": 28.1234,
    "min_psnr": 25.6789,
    "max_psnr": 30.9876,
    "std_psnr": 1.2345
  }
}
```

## æ–‡ä»¶åŒ¹é…è§„åˆ™

TraReportä¼šè‡ªåŠ¨åŒ¹é…valç›®å½•å’Œgtç›®å½•ä¸­çš„æ–‡ä»¶ï¼š
- æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼š`.jpg`, `.jpeg`, `.png`, `.bmp`, `.tiff`
- åŒ¹é…è§„åˆ™ï¼šåŸºäºæ–‡ä»¶åï¼ˆä¸å«æ‰©å±•åï¼‰è¿›è¡ŒåŒ¹é…
- ä¾‹å¦‚ï¼š`val/001.png` ä¼šåŒ¹é… `gt/001.jpg`

## ç¤ºä¾‹è„šæœ¬

é¡¹ç›®åŒ…å«ä»¥ä¸‹ç¤ºä¾‹è„šæœ¬ï¼š

1. **`example_tra_report.py`**: åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹å’Œæ‰¹é‡è¯„ä¼°ç¤ºä¾‹
2. **`run_tra_report.py`**: å‘½ä»¤è¡Œè¿è¡Œè„šæœ¬

## æ³¨æ„äº‹é¡¹

1. **GPUå†…å­˜**: ç¡®ä¿æœ‰è¶³å¤Ÿçš„GPUå†…å­˜æ¥åŠ è½½æ¨¡å‹å’Œå¤„ç†å›¾ç‰‡
2. **æ–‡ä»¶æ ¼å¼**: ç¡®ä¿å›¾ç‰‡æ–‡ä»¶æ ¼å¼æ­£ç¡®ä¸”å¯è¯»å–
3. **è·¯å¾„è®¾ç½®**: ç¡®ä¿æ‰€æœ‰è·¯å¾„å‚æ•°æ­£ç¡®ä¸”æ–‡ä»¶å­˜åœ¨
4. **é…ç½®æ–‡ä»¶**: ç¡®ä¿æ¨¡å‹é…ç½®æ–‡ä»¶ä¸æ£€æŸ¥ç‚¹åŒ¹é…

## é”™è¯¯å¤„ç†

TraReportåŒ…å«å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š
- è‡ªåŠ¨éªŒè¯è¾“å…¥å‚æ•°å’Œæ–‡ä»¶è·¯å¾„
- å¤„ç†å•ä¸ªæ–‡ä»¶å¤„ç†å¤±è´¥çš„æƒ…å†µ
- æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•è¾“å‡º

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ‰¹é‡å¤„ç†**: å¯¹äºå¤§é‡å›¾ç‰‡ï¼Œå»ºè®®åˆ†æ‰¹å¤„ç†ä»¥é¿å…å†…å­˜æº¢å‡º
2. **GPUä¼˜åŒ–**: ç¡®ä¿ä½¿ç”¨GPUåŠ é€Ÿè®¡ç®—
3. **å‚æ•°è°ƒä¼˜**: æ ¹æ®å…·ä½“éœ€æ±‚è°ƒæ•´DDPMæ­¥æ•°å’Œé¢œè‰²ä¿®å¤å‚æ•°

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **CUDAå†…å­˜ä¸è¶³**
   - å‡å°‘batch sizeæˆ–ä½¿ç”¨CPUæ¨¡å¼
   - é™ä½å›¾ç‰‡åˆ†è¾¨ç‡

2. **æ¨¡å‹åŠ è½½å¤±è´¥**
   - æ£€æŸ¥æ¨¡å‹è·¯å¾„å’Œé…ç½®æ–‡ä»¶è·¯å¾„
   - ç¡®è®¤æ¨¡å‹æ–‡ä»¶å®Œæ•´æ€§

3. **æ–‡ä»¶åŒ¹é…å¤±è´¥**
   - æ£€æŸ¥æ–‡ä»¶å‘½åè§„åˆ™
   - ç¡®è®¤æ–‡ä»¶æ ¼å¼æ”¯æŒ

4. **PSNRè®¡ç®—å¼‚å¸¸**
   - æ£€æŸ¥å›¾ç‰‡å°ºå¯¸åŒ¹é…
   - ç¡®è®¤å›¾ç‰‡æ•°æ®èŒƒå›´æ­£ç¡®

å¦‚æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·æ£€æŸ¥é”™è¯¯æ—¥å¿—æˆ–è”ç³»å¼€å‘è€…ã€‚
